{% extends "cosinnus_todo/base.html" %}
{% load i18n humanize todo_tags %}
{% block page_title %}Todo List{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    {% if tag %}
        <li><a href="{% url 'cosinnus:todo:list' group=group.name %}">{% trans "List" %}</a> <span class="divider">/</span></li>
        <li class="active">{{ tag.name }}</li>
    {% else %}
        <li class="active">{% trans "List" %}</li>
    {% endif %}
{% endblock %}

{% block subnav_add_right %}
<a href="{% url 'cosinnus:todo:add' group=group.name %}" class="btn">{% trans "Add new" %}</a>
{{ block.super }}
{% endblock %}

{% block content %}
{% if tags %}
  {% for tag in tags %}
    <a href="{% url 'cosinnus:todo:list-filtered' group=group.name tag=tag.slug %}"><span class="label">{{ tag.name }}</span></a>
  {% endfor %}
{% else %}
  {% trans "No tags available." %}
{% endif %}

{% if object_list %}
<table class="table table-striped">
    <thead>
        <td><a href="{{ request.path }}{{ sort_helper.get_sort_query_by_title }}">{% trans "Title" %}</a></td>
        <td><a href="{{ request.path }}{{ sort_helper.get_sort_query_by_completed_by }}">{% trans "Due by" %}</a></td>
        <td><a href="{{ request.path }}{{ sort_helper.get_sort_query_by_assigned_to }}">{% trans "Assigned to" %}</a></td>
        <td><a href="{{ request.path }}{{ sort_helper.get_sort_query_by_is_completed }}">{% trans "Status" %}</a></td>
        <td>{% trans "Tags" %}</td>
        <td>{% trans "Actions" %}</td>
    </thead>
    {% for object in object_list %}
        <tr class="{% if object.due_date|is_past %}info{% else %}{% if object.priority == 1 %}error{% elif object.priority == 2 %}warning{% else %}success{% endif %}{% endif %}">
            <td><a href="{% url 'cosinnus:todo:entry' group=group.name todo=object.id %}">{{ object.title }}</a></td>
            <td>{{ object.due_date|naturaltime|default_if_none:"" }}</td>
            <td>{% if object.assigned_to %}{{ object.assigned_to }}{% endif %}</td>
            <td>
                {% if object.is_completed %}
                    <span class="badge badge-success" title="{{ object.completed_date|date:"DATETIME_FORMAT" }} -- {{ object.completed_by }}">{% trans "Completed" %}</span></td>
                {% else %}
                    <span class="badge badge-important">{% trans "Open" %}</span>
                {% endif %}
            </td>
            <td>
                {% for tag in object.tags.all %}
                    <a href="{% url 'cosinnus:todo:list-filtered' group=group.name tag=tag.slug %}"><span class="label">{{ tag.name }}</span></a>
                {% empty %}
                -
                {% endfor %}
            </td>
            <td>
                <div class="btn-group">
                    <a class="btn btn-primary btn-mini" href="{% url 'cosinnus:todo:entry' group=group.name todo=object.id %}"><i class="icon-eye-open icon-white"></i> {% trans "Show" %}</a>
                    <a class="btn btn-primary btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{% url 'cosinnus:todo:entry-edit' group=group.name todo=object.id %}"><i class="icon-pencil"></i> {% trans "Edit" %}</a></li>
                        <li><a href="{% url 'cosinnus:todo:entry-delete' group=group.name todo=object.id %}"><i class="icon-trash"></i> {% trans "Delete" %}</a></li>
                        <li class="divider"></li>

                        {% if object.assigned_to == request.user %}
                            <li><a href="{% url 'cosinnus:todo:entry-unassign' group=group.name todo=object.id %}"><i class="icon-star-empty"></i> {% trans "Unassign" %}</a></li>
                            <li><a href="{% url 'cosinnus:todo:entry-assign' group=group.name todo=object.id %}"><i></i> {% trans "Assign someone else" %}</a></li>
                        {% elif object.assigned_to %}
                            <li><a href="{% url 'cosinnus:todo:entry-assign-me' group=group.name todo=object.id %}"><i class="icon-star"></i> {% trans "Assign to me" %}</a></li>
                            <li><a href="{% url 'cosinnus:todo:entry-unassign' group=group.name todo=object.id %}"><i class="icon-star-empty"></i> {% trans "Unassign" %}</a></li>
                        {% else %}
                            <li><a href="{% url 'cosinnus:todo:entry-assign-me' group=group.name todo=object.id %}"><i class="icon-star"></i> {% trans "Assign to me" %}</a></li>
                            <li><a href="{% url 'cosinnus:todo:entry-assign' group=group.name todo=object.id %}"><i></i> {% trans "Assign someone else" %}</a></li>
                        {% endif %}

                        {% if object.is_completed %}
                            <li><a href="{% url 'cosinnus:todo:entry-incomplete' group=group.name todo=object.id %}"><i class="icon-remove"></i> {% trans "Mark incomplete" %}</a></li>
                        {% else %}
                            <li><a href="{% url 'cosinnus:todo:entry-complete-me' group=group.name todo=object.id %}"><i class="icon-ok"></i> {% trans "Finish yourself" %}</a></li>
                            <li><a href="{% url 'cosinnus:todo:entry-complete' group=group.name todo=object.id %}"><i></i> {% trans "Mark complete (other)" %}</a></li>
                        {% endif %}
                    </ul>
                </div>
            </td>
        </tr>
    {% endfor %}
</table>
{% else %}
<p>{% trans "There are no todo entries." %}</p>
{% endif %}
{% endblock %}
